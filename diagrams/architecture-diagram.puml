@startuml KiteClass Platform Architecture
!theme plain
skinparam linetype ortho
!pragma layout smetana
skinparam rectangle {
    BackgroundColor<<kitehub>> #E3F2FD
    BackgroundColor<<kiteclass>> #E8F5E9
    BackgroundColor<<aws>> #FFF3E0
    BorderColor #424242
    FontSize 11
}

title KiteClass Platform - System Architecture V2

' Users
actor "Users\n(Students/Instructors)" as users #lightblue

' AWS Edge Services
rectangle "Route 53\n(DNS)" as route53 <<aws>> #FFE0B2
rectangle "CloudFront\n(CDN)" as cloudfront <<aws>> #FFE0B2
rectangle "Application\nLoad Balancer" as alb <<aws>> #FFE0B2

' EKS Cluster
package "AWS EKS Cluster" {

    ' KiteHub Namespace
    package "KiteHub Namespace\n(Modular Monolith)" <<kitehub>> {
        rectangle "Sale Module\n[Java Spring Boot]" as sale #BBDEFB
        rectangle "Message Module\n[Node.js]" as message #BBDEFB
        rectangle "Maintaining Module\n[Java Spring Boot]" as maintain #BBDEFB
        rectangle "AI Agent Module\n[Python FastAPI]" as ai #BBDEFB
    }

    ' KiteClass Instance
    package "KiteClass Instance #1\n(Microservices)" <<kiteclass>> {
        rectangle "Main Class Service\n[Java]" as mainclass #C8E6C9
        rectangle "User Service\n[Java]" as user #C8E6C9
        rectangle "CMC Service\n[Java]" as cmc #C8E6C9
        rectangle "Video Service\n[Java]" as video #C8E6C9
        rectangle "Streaming Service\n[Node.js]" as streaming #C8E6C9
        rectangle "Forum Service\n[Java]" as forum #C8E6C9
        rectangle "Frontend\n[Next.js SSR]" as frontend #C8E6C9
    }

    package "KiteClass Instance #N\n..." <<kiteclass>> {
        rectangle "Services..." as more #C8E6C9
    }
}

' Database Layer
database "Aurora PostgreSQL\nServerless v2" as aurora <<aws>> #FFE0B2
database "ElastiCache\nRedis" as redis <<aws>> #FFE0B2
storage "S3 Buckets" as s3 <<aws>> #FFE0B2
queue "SQS" as sqs <<aws>> #FFE0B2

' External AI Services
cloud "AI Services" as aiservices {
    rectangle "OpenAI GPT-4" as gpt4 #FFF9C4
    rectangle "Stable Diffusion XL" as sd #FFF9C4
}

' User Flow
users --> route53
route53 --> cloudfront
cloudfront --> alb
alb --> sale
alb --> frontend

' KiteHub Internal
sale --> maintain
sale --> ai
ai --> aiservices
maintain --> sqs

' KiteHub to Storage
ai --> s3
sale --> aurora
maintain --> aurora

' Frontend to Backend Services
frontend --> mainclass
frontend --> user
frontend --> cmc

' Services to Storage
mainclass --> aurora
user --> aurora
cmc --> aurora
video --> s3
streaming --> redis

@enduml
